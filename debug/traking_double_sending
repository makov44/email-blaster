select t1._count, t1.res_id, t2.email  from (SELECT t0.res_id , count(*) as _count
	FROM public.mail_mail_statistics as t0
    group by t0.res_id
    having count(*) >1) as t1
    left join public.mail_mass_mailing_contact as t2 on t1.res_id = t2.id
    order by t1._count desc;


SELECT email, category_id FROM public.emails
WHERE id IN (SELECT id
              FROM (SELECT id,
                             ROW_NUMBER() OVER (partition BY email, category_id ORDER BY id desc) AS rnum
                     FROM public.emails) t
              WHERE t.rnum > 1) ) as int_query
    order by int_query.email

select case  when opened_user_agent like '%iPhone%' then 'iPhone'
            when opened_user_agent like '%iPad%' then 'iPad'
            when opened_user_agent like '%Macintosh%' then 'Mac'
            when opened_user_agent like '%Android%' then 'Android'
            when opened_user_agent like '%Android%' then 'Android'
            when opened_user_agent like '%GoogleImageProxy%' then 'GoogleImageProxy'
            when opened_user_agent like '%Mozilla/5.0 (Windows NT%' then 'Mozilla/5.0 (Windows NT)'
            when opened_user_agent like '%Microsoft Outlook%' then 'Microsoft Outlook'
            when opened_user_agent like '%Mozilla/4.0 (compatible%' then 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident)'
            else opened_user_agent
          end   as user_agent_adj , count(*) from mail_mail_statistics
where (opened is not Null) and (opened_user_agent is not Null )
group by user_agent_adj
order by count(*) desc